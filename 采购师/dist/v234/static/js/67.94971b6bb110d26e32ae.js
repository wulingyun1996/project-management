webpackJsonp([67],{RFmc:function(t,o){},ut8x:function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=e("mvHQ"),s=e.n(i),a=e("bdOr"),n=e("Uwql"),c=e("qIUM"),r=e("bh5B"),u=e("DHfu"),l=e("X2Oc"),d=e("TfiU"),h=(d.mixins,l.l,a.default,n.default,c.default,r.a,{data:function(){return{quotation:[],isManage:!0,hasSelect:!1,name:"",isCheckAll:!1,id:"",buyer_id:"",showConfirm:!1,isFirstEnter:!1,firstGuidePage:!0,twoGuidePage:!1,isShowSharePopup:!1,limitMoreClick:!0}},computed:{quotationLength:function(){return!!this.quotation.length},isSelect:function(){return Object(d.isSelectArr)(this.quotation)},total:function(){var t=this,o=0,e=0,i=0,s=0,a=0;return this.quotation.length>0&&this.quotation.map(function(n){n.goodsInfo.map(function(n){a+=1,n.kinds.map(function(a){if(t.hasSelect){if(a.checked){if(1===n.goods_type)o=Object(d.solove)(o,Object(d.solove)(a.count,a.price,"*"),"+"),s+=0;else if(0===n.price_type)o=Object(d.solove)(o,Object(d.solove)(a.count,a.promotion_price,"*"),"+"),s=a.svip_price?Object(d.solove)(s,Object(d.solove)(a.count,Object(d.formatCommission)(Object(d.solove)(Object(d.solove)(a.promotion_price,a.purchase_price,"-"),Object(d.solove)(1,a.one_discount,"+"),"*")),"*"),"+"):Object(d.solove)(s,Object(d.solove)(a.count,Object(d.solove)(a.promotion_price,a.purchase_price,"-"),"*"),"+");else{var c=Object(d.totalNum)(n.kinds,t.hasSelect),r=Object(d.resultPrice)(c,n.intervalPrice,a,t.hasSelect,a.checked);if(o=Object(d.solove)(o,Object(d.solove)(a.count,r.promotion_price,"*"),"+"),a.svip_price){var u=Object(d.formatCommission)(Object(d.solove)(Object(d.solove)(r.promotion_price,r.purchase_price,"-"),Object(d.solove)(1,a.one_discount,"+"),"*"));s=Object(d.solove)(s,Object(d.solove)(a.count,u,"*"),"+")}else s=Object(d.solove)(s,Object(d.solove)(a.count,Object(d.solove)(r.promotion_price,r.purchase_price,"-"),"*"),"+")}i++,e+=Number(a.count)}}else{if(1===n.goods_type)o=Object(d.solove)(o,Object(d.solove)(a.count,a.price,"*"),"+"),s+=0;else if(0===n.price_type)o=Object(d.solove)(o,Object(d.solove)(a.count,a.promotion_price,"*"),"+"),s=a.svip_price?Object(d.solove)(s,Object(d.solove)(a.count,Object(d.formatCommission)(Object(d.solove)(Object(d.solove)(a.promotion_price,a.purchase_price,"-"),Object(d.solove)(1,a.one_discount,"+"),"*")),"*"),"+"):Object(d.solove)(s,Object(d.solove)(a.count,Object(d.solove)(a.promotion_price,a.purchase_price,"-"),"*"),"+");else{var l=Object(d.totalNum)(n.kinds,t.hasSelect),h=Object(d.resultPrice)(l,n.intervalPrice,a,t.hasSelect,!1);if(o=Object(d.solove)(o,Object(d.solove)(a.count,h.promotion_price,"*"),"+"),a.svip_price){var v=Object(d.formatCommission)(Object(d.solove)(Object(d.solove)(h.promotion_price,h.purchase_price,"-"),Object(d.solove)(1,a.one_discount,"+"),"*"));s=Object(d.solove)(s,Object(d.solove)(a.count,v,"*"),"+")}else s=Object(d.solove)(s,Object(d.solove)(a.count,Object(d.solove)(h.promotion_price,h.purchase_price,"-"),"*"),"+")}i++,e+=Number(a.count)}})})}),{totalAmount:a,totalPrice:o,totalNumber:e,totalKinds:i,totalCommission:s}},selectTotal:function(){var t=0,o=0;return this.quotation.length>0&&this.quotation.map(function(e){e.goodsInfo.map(function(e){e.kinds.map(function(e){e.checked&&(o++,t+=Number(e.count))})})}),{totalNumber:t,totalKinds:o}}},mixins:[d.mixins],created:function(){this.judgeFirstEnter()},mounted:function(){this.name=sessionStorage.quotationName?sessionStorage.quotationName:"",this.quotation=JSON.parse(sessionStorage.quotation);for(var t=sessionStorage.addQuotation?JSON.parse(sessionStorage.addQuotation):[],o=0;o<t.length;o++){var e=this.checkResult(t[o],this.quotation,"seller_id");if(-1===e)this.quotation.push(t[o]);else for(var i=0;i<t[o].goodsInfo.length;i++){var a=this.checkResult(t[o].goodsInfo[i],this.quotation[e].goodsInfo,"goods_id");if(-1===a)this.quotation[e].goodsInfo.push(t[o].goodsInfo[i]);else for(var n=0;n<t[o].goodsInfo[i].kinds.length;n++)this.quotation[e].goodsInfo[a].kinds.push(t[o].goodsInfo[i].kinds[n])}}sessionStorage.quotation=s()(this.quotation),sessionStorage.addQuotation="",this.quotation.map(function(t){t.checked=!1,t.goodsInfo.map(function(t){t.checked=!1,t.kinds.map(function(t){t.checked=!1})})})},methods:{judgeFirstEnter:function(){var t=this;this.$http("cart/firstLogin").then(function(o){o.code===t.$ok&&(t.isFirstEnter=!o.data)})},showNextGuidePage:function(){this.firstGuidePage=!1,this.twoGuidePage=!0},closeGuidePopup:function(){this.isFirstEnter=!1,this.firstGuidePage=!0,this.twoGuidePage=!1},showSharePopup:function(){this.isShowSharePopup=!0},hideSharePopup:function(){this.isShowSharePopup=!1,this.$router.push({name:"QuotationList"})},shareQuotation:function(){var t=Object(u.d)(),o={type:4,url:"/pages/quotationDetail/main?id="+this.id+"&buyer_id="+this.buyer_id,title:"这是您的专属报价单，点此购买省更多！！！",discriable:"这是您的专属报价单，点此购买省更多！！！",imgUrl:Object(l.o)(this.quotation[0].goodsInfo[0].goods_img,200,200),from:2,shopCartId:this.id};try{if("Android"===t)return void window.android.share(s()(o));"iOS"===t&&window.webkit.messageHandlers.share.postMessage(s()(o))}catch(t){}this.hideSharePopup()},checkResult:function(t,o,e){if(0===o.length)return-1;for(var i=0;i<o.length;i++)if(t[e]===o[i][e])return i;return-1},isEnough:function(){for(var t=0;t<this.quotation.length;t++)for(var o=0;o<this.quotation[t].goodsInfo.length;o++)for(var e=0;e<this.quotation[t].goodsInfo[o].kinds.length;e++){if(1!==this.quotation[t].goodsInfo[o].goods_type)if(Object(d.totalNum)(this.quotation[t].goodsInfo[o].kinds,!1)<this.quotation[t].goodsInfo[o].buy_number)return this.$t("["+this.quotation[t].goodsInfo[o].goods_name+"]起批量至少为："+this.quotation[t].goodsInfo[o].buy_number+"件","bottom"),!0}return!1},save:function(){var t=this;if(this.limitMoreClick)if(""!==this.name.trim())if(0!==this.quotation.length){if(!this.isEnough()){var o=[];this.quotation.map(function(t){t.goodsInfo.map(function(e){e.kinds.map(function(i){o.push({goods_num:i.count,seller_id:t.seller_id,goods_id:e.goods_id,spec_key:i.spec_key})})})});var e={offer_name:this.name,goodsInfo:s()(o),id:"",sameQuotat:""};this.limitMoreClick=!1,this.$http("cart/offerEdit",e).then(function(o){200===o.code?(t.limitMoreClick=!1,t.showSharePopup(),t.id=o.data.id,t.buyer_id=o.data.buyer_id,sessionStorage.quotation=""):t.$t(o.message,"middle")})}}else this.$t("报价单无商品");else this.$t("请输入报价单名称")},addQuotation:function(){sessionStorage.quotation=s()(this.quotation),this.$router.push({path:"/add-quotation"})},toggleDel:function(){this.hasSelect=!0},formatPrice:function(t){return Object(d.formatPrice)(t)},add:function(t){this.hasSelect||t.count++},valid:function(t,o){/^[1-9][0-9]*$/.test(t.count)&&t.count?1===o.goods_type&&t.count>o.buy_number&&(t.count=o.buy_number):t.count=1},reduce:function(t){if(!this.hasSelect){if(1===t.count)return;t.count--}},finish:function(){this.hasSelect=!1},del:function(t,o,e,i){this.checkQuotationList(o,e,i)},checkQuotationList:function(t,o,e){var i=this.quotation[e].goodsInfo[o].kinds.length,s=this.quotation[e].goodsInfo.length;i<=1?s<=1?this.quotation.splice(e,1):this.quotation[e].goodsInfo.splice(o,1):this.quotation[e].goodsInfo[o].kinds.splice(t,1)},formatCommission:function(t){return Object(d.formatCommission)(t)}},beforeRouteEnter:function(t,o,e){e(function(t){"/quotation"===o.path&&(t.name="")})},beforeRouteLeave:function(t,o,e){sessionStorage.quotationName=this.name,sessionStorage.quotation=s()(this.quotation),e()},filters:{retainTwoDecimal:l.l},components:{delItem:a.default,checkAll:n.default,makeQuotationItem:c.default,Scroll:r.a}}),v={render:function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("div",{staticClass:"make-quotation iphone-x-container"},[i("header",{ref:"header"},[i("div",{staticClass:"arrow-left",on:{click:function(o){t.showConfirm=!0}}},[i("img",{attrs:{src:e("DaLP"),alt:""}})]),t._v(" "),i("div",{staticClass:"title"},[t._v("\n      制作报价单\n    ")]),t._v(" "),i("div",{staticClass:"build"},[i("span",{staticClass:"add-icon"}),t._v(" "),i("span",{on:{click:t.addQuotation}},[t._v("添加商品")])])]),t._v(" "),i("div",{staticClass:"quotation-title"},[i("span",[t._v("报价单名称")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],attrs:{type:"text",placeholder:"请输入报价单名称 最多12个字",maxlength:"12"},domProps:{value:t.name},on:{input:function(o){o.target.composing||(t.name=o.target.value)}}})]),t._v(" "),i("scroll",{directives:[{name:"show",rawName:"v-show",value:t.quotationLength,expression:"quotationLength"}],staticClass:"make-quotation-scroll"},[i("div",{staticClass:"list",class:t.hasSelect?"list-del":""},t._l(t.quotation,function(o,e){return i("make-quotation-item",{key:e,attrs:{item:o,"quotation-index":e,hasSelect:t.hasSelect},on:{selectShop:t.selectShop,selectGood:t.selectGood,selectKind:t.selectKind,add:t.add,reduce:t.reduce,valid:t.valid,deleteQuotationItem:t.del}})}))]),t._v(" "),i("footer",{directives:[{name:"show",rawName:"v-show",value:t.quotationLength,expression:"quotationLength"}]},[i("check-all",{attrs:{title:"零售底价合计",hasSelect:t.hasSelect,totalPrice:t.total.totalPrice,totalCommission:t.total.totalCommission,totalKinds:t.total.totalKinds,totalNumber:t.total.totalNumber}}),t._v(" "),i("div",{staticClass:"btn-area",on:{click:t.save}},[t._v("\n      保存并分享报价单\n    ")])],1),t._v(" "),i("transition",{attrs:{name:"slide"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSharePopup,expression:"isShowSharePopup"}],staticClass:"share-popup",on:{click:function(o){return o.target!==o.currentTarget?null:t.hideSharePopup(o)}}},[i("div",{staticClass:"share-popup-wrapper"},[i("h1",{staticClass:"share-title"},[t._v("分享报价单")]),t._v(" "),i("span",{staticClass:"share-close",on:{click:t.hideSharePopup}}),t._v(" "),i("div",{staticClass:"share-body"},[i("p",[t._v("您只需要将此报价单分享出去，不用囤货，不用发货，无额外费用，产生成交就有佣金拿，多劳多得，上不封顶哦！")]),t._v(" "),i("h5",[i("span",{staticClass:"share-title-text"},[t._v("分享可赚取佣金：")]),t._v(" "),i("span",{staticClass:"share-title-comission"},[t._v("￥"+t._s(t._f("retainTwoDecimal")(t.total.totalCommission)))])]),t._v(" "),i("h2",[i("span",{staticClass:"share-icons"}),t._v(" "),i("span",{staticClass:"share-text"},[t._v(t._s(t.name))])]),t._v(" "),i("div",{staticClass:"item"},[i("span",{staticClass:"item-dot"}),t._v(" "),i("span",{staticClass:"item-text"},[t._v("店铺数：")]),t._v(" "),i("span",{staticClass:"item-number"},[t._v(t._s(t.quotation.length))])]),t._v(" "),i("div",{staticClass:"item"},[i("span",{staticClass:"item-dot"}),t._v(" "),i("span",{staticClass:"item-text"},[t._v("商品数：")]),t._v(" "),i("span",{staticClass:"item-number"},[t._v(t._s(t.total.totalAmount))])]),t._v(" "),i("div",{staticClass:"item"},[i("span",{staticClass:"item-dot"}),t._v(" "),i("span",{staticClass:"item-text"},[t._v("家装业主购买价：")]),t._v(" "),i("span",{staticClass:"item-number"},[t._v("￥"+t._s(t._f("retainTwoDecimal")(t.total.totalPrice)))])])]),t._v(" "),i("div",{staticClass:"share-icon",on:{click:t.shareQuotation}},[i("img",{attrs:{src:e("McnM"),alt:""}}),t._v(" "),i("p",[t._v("微信好友")])])])])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showConfirm,expression:"showConfirm"}],staticClass:"mask1"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showConfirm,expression:"showConfirm"}],staticClass:"module1"},[i("div",{staticClass:"title1"},[t._v("是否放弃本次报价单编辑")]),t._v(" "),i("div",{staticClass:"btn"},[i("span",{on:{click:function(o){t.$router.go(-1)}}},[t._v("确定")]),t._v(" "),i("span",{on:{click:function(o){t.showConfirm=!1}}},[t._v("取消")])])])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isFirstEnter,expression:"isFirstEnter"}],staticClass:"quotation-guide1"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.firstGuidePage,expression:"firstGuidePage"}],staticClass:"guide-bg1",on:{click:t.showNextGuidePage}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.twoGuidePage,expression:"twoGuidePage"}],staticClass:"guide-bg2",on:{click:t.closeGuidePopup}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.quotationLength,expression:"!quotationLength"}],staticClass:"quotation-no-quotation"},[i("img",{attrs:{src:e("1Cmb"),alt:""}}),t._v(" "),i("p",[t._v("报价单内没有商品哦，快去添加商品吧！")]),t._v(" "),i("div",{staticClass:"add-quotation",on:{click:t.addQuotation}},[i("span",{staticClass:"add-icon"}),t._v(" "),i("span",{staticClass:"add-text"},[t._v("添加商品")])])])],1)},staticRenderFns:[]};var m=e("VU/8")(h,v,!1,function(t){e("RFmc")},"data-v-cd95c44e",null);o.default=m.exports}});